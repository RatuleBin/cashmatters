{% extends "wagtailadmin/base.html" %}
{% load i18n wagtailadmin_tags %}

{% block titletag %}{% trans "Blog pages" %}{% endblock %}
{% block bodyclass %}page-explorer{% endblock %}

{% block extra_css %}
<style>
  /* Layout */
  .bp-wrap{display:flex; gap:24px; align-items:flex-start;}
  .bp-main{flex: 1 1 auto; min-width: 0;}
  .bp-side{width: 320px;}
  @media (max-width: 1100px){
    .bp-wrap{flex-direction:column;}
    .bp-side{width:100%;}
  }
  .nice-padding {
    padding-top: 40px !important;
}

  /* Top bar improved */
  .bp-top{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:24px;
    margin-bottom:28px;
    padding-bottom:18px;
    border-bottom:1px solid #eee;
  }
  .bp-top-left{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .bp-title{font-size:30px; font-weight:700; margin:0; color:#4b1f6f;}
  .bp-count{color:#6b7280; font-weight:500; font-size:14px;}

  /* Search */
  .bp-search{
    flex: 0 0 520px;
    position:relative;
  }
  .bp-search svg{position:absolute; left:12px; top:50%; transform:translateY(-50%); opacity:.55;}
  .bp-search input{
    width:100%;
    padding:12px 14px 12px 40px;
    border:1px solid #dcdcdc;
    border-radius:6px;
    background:#fff;
    font-size:14px;
  }
  .bp-search input:focus{
    outline:none;
    border-color:#0d7a78;
    box-shadow:0 0 0 2px rgba(13,122,120,.1);
  }

  /* Add button improved */
  .bp-add{
    display:inline-flex;
    align-items:center;
    gap:10px;
    background:#0d7a78;
    color:#fff;
    border-radius:6px;
    padding:12px 20px;
    font-weight:700;
    text-decoration:none;
    font-size:14px;
    box-shadow:0 2px 6px rgba(0,0,0,.08);
    white-space:nowrap;
  }
  .bp-add:hover{filter:brightness(.95); transform:translateY(-1px); transition:.15s ease;}

  /* Table */
  .bp-table{width:100%; border-collapse:collapse; background:#fff;}
  .bp-table thead th{
    text-align:left; font-weight:700; padding:10px 8px;
    color:#227c7a;
    border-bottom:1px solid #eaeaea;
    font-size:13px;
    white-space:nowrap;
  }
  .bp-sortlink{
    color:inherit;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap:6px;
  }
  .bp-sorticon{
    font-size:11px;
    opacity:.8;
  }
  .bp-table tbody td{
    padding:14px 8px;
    border-bottom:1px solid #f0f0f0;
    vertical-align:middle;
  }
  .bp-title-link{
    color:#4b1f6f; font-weight:700; text-decoration:none;
  }
  .bp-title-link:hover{text-decoration:underline;}

  .bp-actions{display:flex; gap:8px; flex-wrap:wrap;}
  .bp-btn{
    display:inline-flex; align-items:center; justify-content:center;
    height:26px; padding:0 10px;
    border-radius:3px; font-weight:700; font-size:12px;
    text-decoration:none; border:1px solid transparent;
  }
  .bp-btn.edit, .bp-btn.copy, .bp-btn.unpub{background:#0d7a78; color:#fff;}
  .bp-btn.delete{background:#fff; color:#d92d2d; border-color:#d92d2d;}
  .bp-btn.delete:hover{background:#ffecec;}
  .bp-date{color:#444;}
  .bp-featured{
    display:inline-flex; align-items:center; justify-content:center;
    width:22px; height:22px;
  }
  .bp-featured svg{color:#16a34a;}

  /* Sidebar filters */
  .bp-filter-card{background:#fff; border:1px solid #eee; border-radius:6px; overflow:hidden;}
  .bp-filter-head{padding:10px 12px; background:#f5f5f5; font-weight:700; color:#555; border-bottom:1px solid #eee;}
  .bp-filter-block{padding:12px;}
  .bp-filter-label{font-weight:700; margin:10px 0 8px; color:#555; font-size:13px;}
  .bp-pill{
    display:block;
    padding:8px 10px;
    border:1px solid #73b7b6;
    border-radius:6px;
    color:#0d7a78;
    text-decoration:none;
    font-weight:700;
    margin-bottom:8px;
    background:#fff;
  }
  .bp-pill.is-active{background:#0d7a78; color:#fff; border-color:#0d7a78;}
</style>
{% endblock %}

{% block content %}
<div class="nice-padding">

  <!-- Top bar -->
  <div class="bp-top">

    <div class="bp-top-left">
      <h1 class="bp-title">{% trans "Blog pages" %}</h1>
      <div class="bp-count">
        {{ filtered_count }} {% trans "results" %} · {{ total_count }} {% trans "total" %}
      </div>
    </div>

    <form method="get" class="bp-search">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>

      <input type="text" name="q" value="{{ search_query|default:'' }}" placeholder="{% trans 'Search blog pages...' %}">

      {# keep current filters and sorting #}
      {% if type_filter %}<input type="hidden" name="type" value="{{ type_filter }}">{% endif %}
      {% if location_filter %}<input type="hidden" name="location" value="{{ location_filter }}">{% endif %}
      {% if sort %}<input type="hidden" name="sort" value="{{ sort }}">{% endif %}
      {% if dir %}<input type="hidden" name="dir" value="{{ dir }}">{% endif %}
    </form>

    <a class="bp-add" href="{{ add_url }}">
      <span style="font-size:18px; line-height:0;">+</span>
      {% trans "Add blog page" %}
    </a>

  </div>

  <div class="bp-wrap">

    <!-- Main list -->
    <div class="bp-main">

      {# build toggle urls for sorting #}
      {% if sort == 'title' and dir == 'asc' %}
        {% querystring sort='title' dir='desc' page=None as title_sort_url %}
      {% else %}
        {% querystring sort='title' dir='asc' page=None as title_sort_url %}
      {% endif %}

      {% if sort == 'date' and dir == 'asc' %}
        {% querystring sort='date' dir='desc' page=None as date_sort_url %}
      {% else %}
        {% querystring sort='date' dir='asc' page=None as date_sort_url %}
      {% endif %}

      {% if sort == 'modified' and dir == 'asc' %}
        {% querystring sort='modified' dir='desc' page=None as mod_sort_url %}
      {% else %}
        {% querystring sort='modified' dir='asc' page=None as mod_sort_url %}
      {% endif %}

      {% if sort == 'featured' and dir == 'asc' %}
        {% querystring sort='featured' dir='desc' page=None as feat_sort_url %}
      {% else %}
        {% querystring sort='featured' dir='asc' page=None as feat_sort_url %}
      {% endif %}

      <table class="bp-table">
        <thead>
          <tr>
            <th style="width:52%;">
              <a class="bp-sortlink" href="{{ title_sort_url }}">
                {% trans "Title" %}
                {% if sort == 'title' %}
                  <span class="bp-sorticon">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>
                {% endif %}
              </a>
            </th>

            <th style="width:14%;">
              <a class="bp-sortlink" href="{{ date_sort_url }}">
                {% trans "Post Date" %}
                {% if sort == 'date' %}
                  <span class="bp-sorticon">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>
                {% endif %}
              </a>
            </th>

            <th style="width:20%;">
              <a class="bp-sortlink" href="{{ mod_sort_url }}">
                {% trans "Last modified" %}
                {% if sort == 'modified' %}
                  <span class="bp-sorticon">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>
                {% endif %}
              </a>
            </th>

            <th style="width:8%;">
              <a class="bp-sortlink" href="{{ feat_sort_url }}">
                {% trans "Featured" %}
                {% if sort == 'featured' %}
                  <span class="bp-sorticon">{% if dir == 'asc' %}▲{% else %}▼{% endif %}</span>
                {% endif %}
              </a>
            </th>
          </tr>
        </thead>

        <tbody>
          {% for post in page_obj.object_list %}
            <tr>
              <td>
                <a class="bp-title-link" href="{% url 'wagtailadmin_pages:edit' post.id %}">
                  {{ post.title }}
                </a>

                <div class="bp-actions" style="margin-top:10px;">
                  <a class="bp-btn edit" href="{% url 'wagtailadmin_pages:edit' post.id %}">{% trans "Edit" %}</a>
                  <a class="bp-btn copy" href="{% url 'wagtailadmin_pages:copy' post.id %}">{% trans "Copy" %}</a>

                  {% if post.live %}
                    <a class="bp-btn unpub" href="{% url 'wagtailadmin_pages:unpublish' post.id %}">
                      {% trans "Unpublish" %}
                    </a>
                  {% endif %}

                  <a class="bp-btn delete" href="{% url 'wagtailadmin_pages:delete' post.id %}">
                    {% trans "Delete" %}
                  </a>
                </div>
              </td>

              <td class="bp-date">
                {% if post.date %}{{ post.date|date:"M. j, Y" }}{% else %}—{% endif %}
              </td>

              <td class="bp-date">
                {% if post.latest_revision_created_at %}
                  {{ post.latest_revision_created_at|date:"M. j, Y, P" }}
                {% else %}
                  —
                {% endif %}
              </td>

              <td>
                {% if post.featured %}
                  <span class="bp-featured" title="{% trans 'Featured' %}">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 0 0118 0z"/>
                    </svg>
                  </span>
                {% else %}
                  —
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" style="padding:18px;">{% trans "No results." %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if page_obj.has_other_pages %}
        <div style="margin-top:16px; display:flex; gap:10px; align-items:center;">
          {% if page_obj.has_previous %}
            <a class="button button-small" href="{% querystring page=page_obj.previous_page_number %}">{% trans "Previous" %}</a>
          {% endif %}
          <span style="opacity:.75;">
            {% trans "Page" %} {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
          </span>
          {% if page_obj.has_next %}
            <a class="button button-small" href="{% querystring page=page_obj.next_page_number %}">{% trans "Next" %}</a>
          {% endif %}
        </div>
      {% endif %}

    </div>

    <!-- Sidebar filters -->
    <aside class="bp-side">
      <div class="bp-filter-card">
        <div class="bp-filter-head">{% trans "Filter" %}</div>

        <div class="bp-filter-block">
          <div class="bp-filter-label">{% trans "By article types" %}</div>
          <a class="bp-pill {% if not type_filter %}is-active{% endif %}" href="{% querystring type=None page=None %}">{% trans "All" %}</a>
          {% for t in article_types %}
            <a class="bp-pill {% if type_filter == t.slug %}is-active{% endif %}"
               href="{% querystring type=t.slug page=None %}">
              {{ t.name }}
            </a>
          {% endfor %}

          <div class="bp-filter-label" style="margin-top:18px;">{% trans "By locations" %}</div>
          <a class="bp-pill {% if not location_filter %}is-active{% endif %}" href="{% querystring location=None page=None %}">{% trans "All" %}</a>
          {% for loc in locations %}
            <a class="bp-pill {% if location_filter == loc.slug %}is-active{% endif %}"
               href="{% querystring location=loc.slug page=None %}">
              {{ loc.name }}
            </a>
          {% endfor %}
        </div>
      </div>
    </aside>

  </div>
</div>
{% endblock %}
